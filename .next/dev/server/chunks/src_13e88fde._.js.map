{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///home/danudenny/Downloads/geogreen-mapper/src/lib/prisma.ts"],"sourcesContent":["import { PrismaPg } from '@prisma/adapter-pg';\nimport { Pool } from 'pg';\nimport { PrismaClient } from '../generated/prisma';\n\nconst prismaClientSingleton = () => {\n    const connectionString = process.env.DATABASE_URL;\n    const pool = new Pool({ connectionString });\n    const adapter = new PrismaPg(pool);\n\n    return new PrismaClient({ adapter });\n};\n\ndeclare global {\n    var prisma: undefined | ReturnType<typeof prismaClientSingleton>;\n}\n\nconst prisma = globalThis.prisma ?? prismaClientSingleton();\n\nexport default prisma;\n\nif (process.env.NODE_ENV !== 'production') globalThis.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,wBAAwB;IAC1B,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;IACjD,MAAM,OAAO,IAAI,4GAAI,CAAC;QAAE;IAAiB;IACzC,MAAM,UAAU,IAAI,yKAAQ,CAAC;IAE7B,OAAO,IAAI,qJAAY,CAAC;QAAE;IAAQ;AACtC;AAMA,MAAM,SAAS,WAAW,MAAM,IAAI;uCAErB;AAEf,wCAA2C,WAAW,MAAM,GAAG"}},
    {"offset": {"line": 41, "column": 0}, "map": {"version":3,"sources":["file:///home/danudenny/Downloads/geogreen-mapper/src/app/api/tiles/%5Bz%5D/%5Bx%5D/%5By%5D/route.ts"],"sourcesContent":["import prisma from '@/lib/prisma';\nimport { NextRequest, NextResponse } from 'next/server';\n\nexport async function GET(\n    req: NextRequest,\n    props: { params: Promise<{ z: string; x: string; y: string }> }\n) {\n    const params = await props.params;\n\n    const z = parseInt(params.z);\n    const x = parseInt(params.x);\n    const y = parseInt(params.y);\n\n    if (isNaN(z) || isNaN(x) || isNaN(y)) {\n        return new NextResponse('Invalid coordinates', { status: 400 });\n    }\n\n    try {\n        const query = await prisma.$queryRaw`\n            WITH mvtgeom AS (\n                SELECT\n                    ST_AsMVTGeom(\n                        ST_Transform(ST_SetSRID(geom, 4326), 3857),\n                        ST_TileEnvelope(${z}, ${x}, ${y})\n                    ) AS geom,\n                    namobj,\n                    jnsrpr,\n                    luasha,\n                    gid\n                FROM public.pola_ruang_revisi_rtrw\n                WHERE ST_Intersects(\n                    ST_Transform(ST_SetSRID(geom, 4326), 3857),\n                    ST_TileEnvelope(${z}, ${x}, ${y})\n                )\n            )\n            SELECT ST_AsMVT(mvtgeom.*) AS mvt FROM mvtgeom;\n        `;\n\n        // The result of $queryRaw is an array of objects\n        const tile = (query as any)[0]?.mvt;\n\n        if (!tile) {\n            return new NextResponse(null, { status: 204 });\n        }\n\n        return new NextResponse(tile, {\n            headers: {\n                'Content-Type': 'application/vnd.mapbox-vector-tile',\n                'Cache-Control': 'public, max-age=3600, s-maxage=3600',\n            },\n        });\n    } catch (error) {\n        console.error('Error serving tile:', error);\n        return new NextResponse(\n            JSON.stringify({\n                error: String(error),\n                stack: (error as Error).stack,\n            }),\n            { status: 500 }\n        );\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEO,eAAe,IAClB,GAAgB,EAChB,KAA+D;IAE/D,MAAM,SAAS,MAAM,MAAM,MAAM;IAEjC,MAAM,IAAI,SAAS,OAAO,CAAC;IAC3B,MAAM,IAAI,SAAS,OAAO,CAAC;IAC3B,MAAM,IAAI,SAAS,OAAO,CAAC;IAE3B,IAAI,MAAM,MAAM,MAAM,MAAM,MAAM,IAAI;QAClC,OAAO,IAAI,gJAAY,CAAC,uBAAuB;YAAE,QAAQ;QAAI;IACjE;IAEA,IAAI;QACA,MAAM,QAAQ,MAAM,iIAAM,CAAC,SAAS,CAAC;;;;;wCAKL,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE;;;;;;;;;oCASpB,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE;;;;QAI5C,CAAC;QAED,iDAAiD;QACjD,MAAM,OAAO,AAAC,KAAa,CAAC,EAAE,EAAE;QAEhC,IAAI,CAAC,MAAM;YACP,OAAO,IAAI,gJAAY,CAAC,MAAM;gBAAE,QAAQ;YAAI;QAChD;QAEA,OAAO,IAAI,gJAAY,CAAC,MAAM;YAC1B,SAAS;gBACL,gBAAgB;gBAChB,iBAAiB;YACrB;QACJ;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,IAAI,gJAAY,CACnB,KAAK,SAAS,CAAC;YACX,OAAO,OAAO;YACd,OAAO,AAAC,MAAgB,KAAK;QACjC,IACA;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}