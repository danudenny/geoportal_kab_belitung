{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":["file:///home/danudenny/Downloads/geogreen-mapper/src/lib/prisma.ts"],"sourcesContent":["import { PrismaPg } from '@prisma/adapter-pg';\nimport { Pool } from 'pg';\nimport { PrismaClient } from '../generated/prisma';\n\nconst prismaClientSingleton = () => {\n    const connectionString = process.env.DATABASE_URL;\n    const pool = new Pool({ connectionString });\n    const adapter = new PrismaPg(pool);\n\n    return new PrismaClient({ adapter });\n};\n\ndeclare global {\n    var prisma: undefined | ReturnType<typeof prismaClientSingleton>;\n}\n\nconst prisma = globalThis.prisma ?? prismaClientSingleton();\n\nexport default prisma;\n\nif (process.env.NODE_ENV !== 'production') globalThis.prisma = prisma;\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;AAEA,MAAM,wBAAwB;IAC1B,MAAM,mBAAmB,QAAQ,GAAG,CAAC,YAAY;IACjD,MAAM,OAAO,IAAI,4GAAI,CAAC;QAAE;IAAiB;IACzC,MAAM,UAAU,IAAI,yKAAQ,CAAC;IAE7B,OAAO,IAAI,qJAAY,CAAC;QAAE;IAAQ;AACtC;AAMA,MAAM,SAAS,WAAW,MAAM,IAAI;uCAErB;AAEf,wCAA2C,WAAW,MAAM,GAAG"}},
    {"offset": {"line": 41, "column": 0}, "map": {"version":3,"sources":["file:///home/danudenny/Downloads/geogreen-mapper/src/app/api/features/route.ts"],"sourcesContent":["import prisma from '@/lib/prisma';\nimport { NextRequest, NextResponse } from 'next/server';\n\nconst TABLE_MAP: Record<string, string> = {\n    rtrw: 'public.pola_ruang_revisi_rtrw',\n    badau: 'public.pola_ruang_badau',\n    geopark: 'public.pola_ruang_geopark',\n    tanjung: 'public.pola_ruang_tanjung_kelayang',\n};\n\nexport async function GET(req: NextRequest) {\n    const searchParams = req.nextUrl.searchParams;\n    const layer = searchParams.get('layer');\n    const bboxStr = searchParams.get('bbox'); // minx,miny,maxx,maxy\n\n    if (!layer || !TABLE_MAP[layer]) {\n        return new NextResponse('Invalid layer', { status: 400 });\n    }\n\n    if (!bboxStr) {\n        return new NextResponse('Missing bbox parameter', { status: 400 });\n    }\n\n    const bbox = bboxStr.split(',').map(Number);\n    if (bbox.length !== 4 || bbox.some(isNaN)) {\n        return new NextResponse('Invalid bbox format', { status: 400 });\n    }\n\n    const [minx, miny, maxx, maxy] = bbox;\n\n    // Ensure logical bbox\n    if (minx > maxx || miny > maxy) {\n        return new NextResponse('Invalid bbox coordinates', { status: 400 });\n    }\n\n    const tableName = TABLE_MAP[layer];\n\n    try {\n        // Fetch features as GeoJSON\n        // ST_AsGeoJSON provides the geometry\n        // We also want properties. json_build_object helps structure it.\n        const sql = `\n            SELECT \n                json_build_object(\n                    'type', 'Feature',\n                    'geometry', ST_AsGeoJSON(ST_Force2D(ST_Transform(geom, 3857)))::json,\n                    'properties', to_jsonb(t) - 'geom'\n                ) as feature\n            FROM ${tableName} t\n            WHERE ST_Intersects(\n                ST_Force2D(ST_Transform(geom, 3857)),\n                ST_MakeEnvelope(${minx}, ${miny}, ${maxx}, ${maxy}, 3857)\n            )\n            LIMIT 5000; -- Safety limit\n        `;\n\n        const result = await prisma.$queryRawUnsafe(sql);\n        const features = (result as any[]).map((row) => row.feature);\n\n        const geojson = {\n            type: 'FeatureCollection',\n            features: features,\n        };\n\n        return new NextResponse(JSON.stringify(geojson), {\n            headers: { 'Content-Type': 'application/json' },\n        });\n    } catch (error) {\n        console.error('Error fetching features:', error);\n        return new NextResponse(JSON.stringify({ error: String(error) }), {\n            status: 500,\n        });\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEA,MAAM,YAAoC;IACtC,MAAM;IACN,OAAO;IACP,SAAS;IACT,SAAS;AACb;AAEO,eAAe,IAAI,GAAgB;IACtC,MAAM,eAAe,IAAI,OAAO,CAAC,YAAY;IAC7C,MAAM,QAAQ,aAAa,GAAG,CAAC;IAC/B,MAAM,UAAU,aAAa,GAAG,CAAC,SAAS,sBAAsB;IAEhE,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,MAAM,EAAE;QAC7B,OAAO,IAAI,gJAAY,CAAC,iBAAiB;YAAE,QAAQ;QAAI;IAC3D;IAEA,IAAI,CAAC,SAAS;QACV,OAAO,IAAI,gJAAY,CAAC,0BAA0B;YAAE,QAAQ;QAAI;IACpE;IAEA,MAAM,OAAO,QAAQ,KAAK,CAAC,KAAK,GAAG,CAAC;IACpC,IAAI,KAAK,MAAM,KAAK,KAAK,KAAK,IAAI,CAAC,QAAQ;QACvC,OAAO,IAAI,gJAAY,CAAC,uBAAuB;YAAE,QAAQ;QAAI;IACjE;IAEA,MAAM,CAAC,MAAM,MAAM,MAAM,KAAK,GAAG;IAEjC,sBAAsB;IACtB,IAAI,OAAO,QAAQ,OAAO,MAAM;QAC5B,OAAO,IAAI,gJAAY,CAAC,4BAA4B;YAAE,QAAQ;QAAI;IACtE;IAEA,MAAM,YAAY,SAAS,CAAC,MAAM;IAElC,IAAI;QACA,4BAA4B;QAC5B,qCAAqC;QACrC,iEAAiE;QACjE,MAAM,MAAM,CAAC;;;;;;;iBAOJ,EAAE,UAAU;;;gCAGG,EAAE,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,KAAK,EAAE,EAAE,KAAK;;;QAG1D,CAAC;QAED,MAAM,SAAS,MAAM,iIAAM,CAAC,eAAe,CAAC;QAC5C,MAAM,WAAW,AAAC,OAAiB,GAAG,CAAC,CAAC,MAAQ,IAAI,OAAO;QAE3D,MAAM,UAAU;YACZ,MAAM;YACN,UAAU;QACd;QAEA,OAAO,IAAI,gJAAY,CAAC,KAAK,SAAS,CAAC,UAAU;YAC7C,SAAS;gBAAE,gBAAgB;YAAmB;QAClD;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,4BAA4B;QAC1C,OAAO,IAAI,gJAAY,CAAC,KAAK,SAAS,CAAC;YAAE,OAAO,OAAO;QAAO,IAAI;YAC9D,QAAQ;QACZ;IACJ;AACJ"}}]
}